# syntax=docker/dockerfile:1

FROM ubuntu:22.04

# FROM node:18-alpine
# ARG TARGETARCH
# WORKDIR /menuet
# COPY . .
# RUN apk add --update --no-cache python3 build-base gcc && ln -sf /usr/bin/python3 /usr/bin/python


FROM nginx:alpine
# WORKDIR /
# COPY --from=0 /menuet /menuet
COPY nginx.conf /etc/nginx/nginx.conf
RUN apk add bash
RUN apk add --repository http://dl-cdn.alpinelinux.org/alpine/edge/main nodejs=18.16.0-r0 npm=9.1.2-r0
RUN apk add --update --no-cache python3 build-base gcc && ln -sf /usr/bin/python3 /usr/bin/python
RUN npm install -g pm2
WORKDIR /menuet
COPY . .
RUN npm install
CMD ./runner.sh
EXPOSE 8080